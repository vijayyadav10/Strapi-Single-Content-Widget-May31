{"version":3,"sources":["api/Api.js","App.js","custom-element/et-app.js"],"names":["strapiEndPoint","process","EntKcToken","STRAPI_TOKEN","getTemplates","templateIds","a","axios","get","addAuthorizationRequestConfig","templateData","data","filtered","filter","temp","indexOf","id","getContents","contentName","contentIds","length","console","error","apiendpoints","map","el","all","endpoint","item","filterContentByQuery","fieldName","searchQuery","results","log","finaldata","getDefaultOptions","defaultBearer","headers","config","defaultOptions","velocityjs","require","domain","App","contentIdsAndTemplateIds","saveQueryDetails","colLabelName","useState","htmlCode","setHtmlCode","decodeURI","CID_TID","mappingOfDataWithTemplate","getTemplateData","getContentsData","cid_tid_obj","Object","keys","finalTemplate","contentIdAndTemplateId","filterContent","content","contentId","filterTemplate","template","templateId","key","i","Array","isArray","url","render","contentShape","useEffect","JSON","parse","queryDetails","searchTerm","dangerouslySetInnerHTML","__html","ATTRIBUTES","WidgetElement","name","oldValue","newValue","values","includes","Error","this","mountPoint","document","createElement","appendChild","getAttribute","ReactDOM","HTMLElement","customElements","define"],"mappings":"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","file":"static/js/main.954b57c5.chunk.js","sourcesContent":["import axios from 'axios';\n\nconst strapiEndPoint = `${process.env.REACT_APP_STRAPI_API_URL}`;\nconst apiEndPoint = `${process.env.REACT_APP_PUBLIC_API_URL}/template/searchby/`;\nconst EntKcToken = 'EntKcToken';\n\nconst STRAPI_TOKEN = {\n    'Authorization': `Bearer ${process.env.REACT_APP_LOCAL_STRAPI_TOKEN}`\n}\n\nexport const getTemplate = async (searchby = 'code', searchTerm) => {\n    return await axios.get(`${apiEndPoint}${searchby}/${searchTerm}`,addAuthorizationRequestConfig({}))\n}\n\n/**\n * getTemplateById Search Template By Id.\n * @param {*} templateId : TemplateId.\n * @returns \n */\nexport const getTemplateById = async (templateId) => {\n    const { data } = await axios.get(`${process.env.REACT_APP_PUBLIC_API_URL}/template/${templateId}`, addAuthorizationRequestConfig({}));\n    return data;\n}\n\n/**\n * getTemplate Get all templates.\n * @param {*} templateId : TemplateId.\n * @returns\n */\nexport const getTemplates = async (templateIds) => {\n    const { data: templateData } = await axios.get(`${process.env.REACT_APP_PUBLIC_API_URL}/template/`, addAuthorizationRequestConfig({}));\n    const filtered = templateData.filter(temp => {\n        return templateIds.indexOf(temp.id + \"\") > -1\n    });\n    return filtered\n}\n\n/**\n * getContentById Search Content By Id.\n * @param {*} contentType\n * @param {*} contentId\n * @returns\n */\n export const getContentById = async (contentName, contentId) => {\n    if (!contentName || !contentId) console.error(contentName, contentId);\n    const url = `${strapiEndPoint}/content-manager/collection-types/api::${contentName}.${contentName}/${contentId}`;\n    const { data } = await axios.get(url, addAuthorizationRequestConfig({}, EntKcToken))\n\n    return data;\n}\n\n/**\n * getContents get all contents.\n * @param {*} contentType\n * @param {*} contentId\n * @returns\n */\nexport const getContents = async (contentName, contentIds) => {\n    if (!contentName && !contentIds.length) console.error(contentName);\n    const apiendpoints = contentIds.map(el => `${strapiEndPoint}/content-manager/collection-types/api::${contentName}.${contentName}/${el}`);\n    const data = await axios.all(apiendpoints.map((endpoint) => axios.get(endpoint, addAuthorizationRequestConfig({}, EntKcToken))));\n    return data.map((item) => {\n        return item.data;\n    });\n}\n\nexport const filterContentByQuery = async (contentName, fieldName, searchQuery) => {\n    const { data: { results } } = await axios.get(\n        `${strapiEndPoint}/content-manager/collection-types/api::${contentName}.${contentName}?page=1&pageSize=100&sort=createdAt:DESC&filters[${fieldName}][$containsi]=${searchQuery}`,\n        addAuthorizationRequestConfig({}, EntKcToken)\n    );\n    console.log('fullListData >===>', results);\n    if (results) {\n        console.log(results.map(el => el.id))\n        const finaldata = await axios.all(results.map(id => axios.get(\n            `${strapiEndPoint}/content-manager/collection-types/api::${contentName}.${contentName}/${id}`,\n            addAuthorizationRequestConfig({}, EntKcToken))));\n        console.log(finaldata);\n    }\n    return finaldata;\n}\n\nconst getKeycloakToken = () => {\n    return '';\n    if (window && window.entando && window.entando.keycloak && window.entando.keycloak.authenticated) {\n        return window.entando.keycloak.token\n    } else {\n        return localStorage.getItem('token');\n    }\n}\n\nconst getDefaultOptions = (defaultBearer) => {\n    const token = getKeycloakToken()\n    console.log('ET-Widget',token);\n    if (!token) {\n        //Below if condition is to run the strapi API in local\n        if (defaultBearer === EntKcToken) {\n            return {\n                headers: STRAPI_TOKEN\n            }\n        } else {\n            return {}\n        }\n    }\n    // logic to add token for both strapi and MS api\n    return {\n        headers: {\n            Authorization: `${defaultBearer} ${token}`,\n        },\n    }\n}\n\n// Get authorization tokens\nexport const addAuthorizationRequestConfig = (config = {}, defaultBearer = 'Bearer') => {\n    let defaultOptions = getDefaultOptions(defaultBearer);\n    return {\n        ...config,\n        ...defaultOptions\n    }\n}","import React, { useEffect, useRef, useState } from 'react';\nimport { filterContentByQuery, getContentById, getContents, getTemplateById, getTemplates } from './api/Api';\nvar velocityjs = require(\"velocityjs\");\nimport './app.css';\n\nconst domain = process.env.REACT_APP_STRAPI_API_URL;\n\nfunction App({ contentName, contentIdsAndTemplateIds, saveQueryDetails, colLabelName }) {\n    console.log('APP.JS saveQueryDetails', saveQueryDetails, \"fieldSearchBy()()()()\", colLabelName);\n    // TODO: TESTING PURPOSE\n    contentName = contentName ? contentName : 'banner';\n    contentIdsAndTemplateIds = contentIdsAndTemplateIds ? contentIdsAndTemplateIds : '%5B%7B%22templateId%22:%2250%22,%22contentId%22:5%7D,%7B%22templateId%22:%2248%22,%22contentId%22:3%7D,%7B%22templateId%22:%2248%22,%22contentId%22:2%7D%5D';\n\n    const [htmlCode, setHtmlCode] = useState(null);\n    const [CID_TID, set_CID_TID] = useState(decodeURI(contentIdsAndTemplateIds));\n\n    useEffect(async () => {\n        const cid_tid_obj = CID_TID.length && JSON.parse(CID_TID);\n        // templateId: '48', contentId:\n\n        // Check the method to get api it could be Save as Query or Multi Content(CheckBox).\n        if(contentName && saveQueryDetails && colLabelName){\n            console.log('This is Save As Method', contentName , saveQueryDetails , colLabelName);\n            // JSON.parse(decodeURI('%7B%22templateId%22:%2249%22,%22searchTerm%22:%22Title%22%7D')).searchTerm;\n            const queryDetails = JSON.parse(decodeURI(saveQueryDetails));\n            console.log(\"ZZZZ\",queryDetails)\n            const data = await filterContentByQuery(contentName, colLabelName, queryDetails.searchTerm);\n        }\n\n        const getTemplateData = await getTemplates(cid_tid_obj.map(el => el.templateId));\n        const getContentsData = await getContents(contentName, cid_tid_obj.map(el => el.contentId));\n        mappingOfDataWithTemplate(getTemplateData, getContentsData, cid_tid_obj);\n    }, [])\n\n    function mappingOfDataWithTemplate(getTemplateData, getContentsData, cid_tid_obj) {\n        if (getTemplateData && getContentsData && Object.keys(cid_tid_obj).length) {\n            const finalTemplate = cid_tid_obj.map(contentIdAndTemplateId => {\n                const filterContent = getContentsData.filter(content => content.id === contentIdAndTemplateId.contentId);\n                const filterTemplate = getTemplateData.filter(template => +template.id === +contentIdAndTemplateId.templateId);\n                // To bind domain with image src(url).\n                if (filterTemplate.length && filterContent[0] && Object.keys(filterContent[0]).length) {\n                    Object.keys(filterContent[0]).map((key, i) => {\n                        if (filterContent[0][key] && Array.isArray(filterContent[0][key])) {\n                            // For MultiMedia\n                            if (filterContent[0][key] && filterContent[0][key][0] && filterContent[0][key][0]['ext']) {\n                                filterContent[0][key].map(el => {\n                                    return el.url = domain + el.url;\n                                });\n                            }\n                        } else if (filterContent[0][key] && typeof filterContent[0][key] === 'object') {\n                            // For SingleMedia\n                            if (filterContent[0][key] && filterContent[0][key]['ext']) {\n                                if (typeof filterContent[0][key] === 'object') {\n                                    filterContent[0][key].url = domain + filterContent[0][key].url;\n                                }\n                            }\n\n                            // object\n                            console.log('filterContent[0][key]', filterContent[0][key]);\n                        }\n                    });\n                    return velocityjs.render(filterTemplate[0].contentShape, { content: filterContent[0] });\n                }\n                return \"\";\n            });\n            setHtmlCode(finalTemplate);\n        }\n    }\n\n    return (\n        <>\n            {\n                htmlCode ?\n                    <div dangerouslySetInnerHTML={{\n                        __html: htmlCode\n                    }}>\n                    </div> : <h1>Loading...</h1>\n            }\n        </>\n    );\n\n}\n\nexport default App;\n","import ReactDOM from \"react-dom\"\nimport React from \"react\"\nimport App from '../App'\n\nconst ATTRIBUTES = {\n    contentName: \"contentName\",\n    contentIdsAndTemplateIds: \"contentIdsAndTemplateIds\",\n    saveQueryDetails: \"saveQueryDetails\",\n    colLabelName: \"colLabelName\"\n};\n\nclass WidgetElement extends HTMLElement {\n\n    static get observedAttributes() {\n        return Object.values(ATTRIBUTES);\n    }\n\n    attributeChangedCallback(name, oldValue, newValue) {\n        if (!Object.values(ATTRIBUTES).includes(name)) {\n            throw new Error(`Untracked changed attribute: ${name}`);\n        }\n        if (this.mountPoint && newValue !== oldValue) {\n            this.render();\n        }\n    }\n\n    connectedCallback() {\n        this.mountPoint = document.createElement('div');\n        this.appendChild(this.mountPoint);\n        this.render();\n    }\n\n    render() {\n        const contentName = this.getAttribute(ATTRIBUTES.contentName);\n        const contentIdsAndTemplateIds = this.getAttribute(ATTRIBUTES.contentIdsAndTemplateIds);\n        const saveQueryDetails = this.getAttribute(ATTRIBUTES.saveQueryDetails);\n        const colLabelName = this.getAttribute(ATTRIBUTES.colLabelName);\n\n        console.log(\"contentName ==>\", contentName, \n        \"contentIdsAndTemplateIds ==>\", contentIdsAndTemplateIds, \n        \"saveQueryDetails ==>\", saveQueryDetails, \"colLabelName<<<<<>>>>>\", colLabelName);\n        ReactDOM.render(\n            <App \n                contentName={contentName}\n                contentIdsAndTemplateIds={contentIdsAndTemplateIds}\n                saveQueryDetails={saveQueryDetails}\n                colLabelName={colLabelName}\n            />,\n            this.mountPoint\n        );\n    }\n}\n\ncustomElements.get('my-list-widget') || customElements.define('my-list-widget', WidgetElement);\n\n\nexport default WidgetElement;\n\n"],"sourceRoot":""}